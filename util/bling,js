const empresaSrv = require("../service/empresaService");
const blingSrv = require("../service/blingService.js");
const variaveis = require("../global/variaveis");

exports.getAtualizaToken = async function(emp) {

    let retorno = {};

    try {

        console.log("getAtualizaToken Empresa: => ", emp);


        try {
            retorno = await blingSrv.getRefreshToken(emp);
        } catch (error) {
            throw error;
        }

        try {

            console.log("retorno", retorno);

            emp.access_token = retorno.access_token.trim();

            emp.refresh_token = retorno.refresh_token.trim();

            const empAlterada = await empresaSrv.updateEmpresa(emp);

            console.log("empAlterada", empAlterada);

        } catch (error) {
            throw error;
        }

        console.log("TOKEN ATUALIZADO COM SUCESSO!");
    } catch (error) {
        throw error;
    }

    return;
};